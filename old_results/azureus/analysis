this one is super complex.
//TODO : more analysis
